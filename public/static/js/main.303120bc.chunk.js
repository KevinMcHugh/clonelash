(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){"use strict";n.r(t);var a=n(17),r=n(39),o=n.n(r),c=(n(53),n(40)),i=n.n(c),s=n(41),l=n.n(s)()(i.a)(),u=n(20),p=n.n(u),m=n(42),f=n(43),d=n.n(f);function h(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r,o=!0,c=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){c=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(c)throw r}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function y(e,t){var n=[],a=d()(e,n).exec(t);if(!a)return null;for(var r=Object.create(null),o=1;o<a.length;o++)r[n[o-1].name]=void 0!==a[o]?a[o]:void 0;return r}function g(){return(g=Object(m.a)(p.a.mark(function e(t,n){var r,o,c,i,s,l,u;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=h(t),e.prev=1,r.s();case 3:if((o=r.n()).done){e.next=16;break}if(c=o.value,i=n.error?"/error":n.pathname,s=y(c.path,i)){e.next=9;break}return e.abrupt("continue",14);case 9:return e.next=11,c.action(Object(a.a)({},n,{params:s}));case 11:if(!(l=e.sent)){e.next=14;break}return e.abrupt("return",l);case 14:e.next=3;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),r.e(e.t0);case 21:return e.prev=21,r.f(),e.finish(21);case 24:throw(u=new Error("Not found")).status=404,u;case 27:case"end":return e.stop()}},e,null,[[1,18,21,24]])}))).apply(this,arguments)}var b={resolve:function(e,t){return g.apply(this,arguments)}},_=n(0),E=n.n(_),C=n(4),k=n(5),R=n(7),w=n(6),j=n(2),O=n(1),S=n.n(O);n(32);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(j.a)(e);if(t){var r=Object(j.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(w.a)(this,n)}}var x=function(e){Object(R.a)(n,e);var t=P(n);function n(){var e;Object(C.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r)))._startGame=function(t){t.preventDefault(),S.a.put("games/"+e.props.game_id,{game:{state:"started"}}).then(function(t){e.setState({game:t.data})}).catch(function(e){return console.log(e)})},e._addAPlayer=function(t){t.preventDefault(),S.a.post("admin/add_player",{game_id:e.props.game_id}).catch(function(e){return console.log(e)})},e._answerQuestions=function(t){t.preventDefault(),S.a.post("admin/answer_questions",{game_id:e.props.game_id}).catch(function(e){return console.log(e)})},e._cancelGame=function(t){t.preventDefault(),S.a.put("games/"+e.props.game_id,{game:{state:"canceled"}}).then(function(t){e.setState({game:t.data})}).catch(function(e){return console.log(e)})},e._completeVotes=function(t){t.preventDefault(),S.a.post("admin/complete_votes",{game_id:e.props.game_id}).catch(function(e){return console.log(e)})},e}return Object(k.a)(n,[{key:"render",value:function(){return this.props.player&&this.props.player.admin?E.a.createElement("div",null,E.a.createElement("button",{onClick:this._startGame},"Start the game now!"),E.a.createElement("button",{onClick:this._addAPlayer},"Add a player."),E.a.createElement("button",{onClick:this._answerQuestions},"Answer all questions."),E.a.createElement("button",{onClick:this._completeVotes},"Complete all votes."),E.a.createElement("button",{onClick:this._cancelGame},"Cancel the game now!")):null}}]),n}(_.Component),D=n(9),A=(n(90),n(10)),N=n.n(A);function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(j.a)(e);if(t){var r=Object(j.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(w.a)(this,n)}}var G=function(e){Object(R.a)(n,e);var t=I(n);function n(e){var a;return Object(C.a)(this,n),(a=t.call(this,e)).handleReceivedPlayer=function(e){if("Player"===e.message_type){var t=a.state.players,n=N.a.findIndex(t,{id:e.id});if(n>=0){var r=t[n];r.score!==e.score&&(e.scoreUpdated=r.scoreUpdated?r.scoreUpdated+1:1),t[n]=e}else t.push(e);a.setState({players:t})}},a.state={players:[]},a}return Object(k.a)(n,[{key:"componentDidMount",value:function(){var e=this;S.a.get("games/"+this.props.game_id+"/players").then(function(t){e.setState({players:t.data})}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){var e={channel:"GameChannel",id:this.props.game_id},t=(this.props.player||{}).id,n=this.props.winners?this.props.winners.map(function(e){return e.id}):[];return this.state.players.length>0?E.a.createElement("div",{className:"Player-container"},E.a.createElement(D.ActionCableConsumer,{channel:e,onReceived:this.handleReceivedPlayer}),this.state.players.map(function(e){var a="Player";return e.id===t&&(a+=" Player-current"),n.includes(e.id)&&(a+=" Player-winner"),e.scoreUpdated&&(a+=" Player-score-updated-"+e.scoreUpdated%2),E.a.createElement("div",{key:e.id,className:a},e.name,E.a.createElement("div",null,"Score: ",e.score,E.a.createElement("div",{className:"Player-score",style:{width:"".concat(10*e.score,"px"),transitionProperty:"width",transitionDuration:"1.5s",transitionTimingFunction:"ease-out"}})))})):E.a.createElement("div",null,"hang on...")}}]),n}(_.Component);n(92);function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(j.a)(e);if(t){var r=Object(j.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(w.a)(this,n)}}var U=function(e){Object(R.a)(n,e);var t=M(n);function n(e){var a;return Object(C.a)(this,n),(a=t.call(this,e)).handleReceivedPlayerMessage=function(e){if("Response"===e.message_type){var t=a.state.prompts;t.some(function(t){return t.id===e.id})||t.push(e),a.setState({prompts:t})}},a._onSubmit=function(e,t){e.preventDefault();var n=e.target.elements[0].value;e.target.elements[0].value="",S.a.put("responses/"+t,{text:n}).then(function(e){var t=a.state.prompts;N.a.remove(t,{id:e.data.id}),a.setState({prompts:t})}).catch(function(e){return console.log(e)})},a.state={prompts:null},a}return Object(k.a)(n,[{key:"componentDidMount",value:function(){var e=this;S.a.get("players/"+this.props.playerId+"/prompts").then(function(t){e.setState({prompts:t.data})}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){var e={channel:"PlayerChannel",id:this.props.playerId};return null===this.state.prompts?E.a.createElement("div",null,"hang on..."):N.a.isEmpty(this.state.prompts)?E.a.createElement("div",null,"Wait for other players..."):N.a.isEmpty(this.state.prompts)?void 0:E.a.createElement("div",{className:"Prompt"},E.a.createElement(D.ActionCableConsumer,{channel:e,onReceived:this.handleReceivedPlayerMessage}),this._renderMessage())}},{key:"_renderMessage",value:function(){var e=N.a.first(this.state.prompts);if(e)return E.a.createElement("div",null,E.a.createElement("div",null," Answer this question: "),e.game_prompt.text,this._renderForm(e))}},{key:"_renderForm",value:function(e){var t=this;if(e.id)return E.a.createElement("form",{onSubmit:function(n){return t._onSubmit(n,e.id)}},E.a.createElement("input",{name:"text",autoComplete:"off",maxlength:30}),E.a.createElement("button",null,"OK"))}}]),n}(_.Component);n(93);function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(j.a)(e);if(t){var r=Object(j.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(w.a)(this,n)}}var W=function(e){Object(R.a)(n,e);var t=J(n);function n(e){var a;return Object(C.a)(this,n),(a=t.call(this,e))._getCurrentGamePrompt=function(){S.a.get("players/"+a.props.playerId+"/current_game_prompt").then(function(e){a.setState({gamePrompt:e.data})}).catch(function(e){return console.log(e)})},a.handleReceivedPlayerMessage=function(e){"GamePrompt"===e.message_type&&a.setState({gamePrompt:e})},a._onClick=function(e,t){S.a.post("votes",{response_id:t,player_id:a.props.playerId,game_prompt_id:a.state.gamePrompt.id}).then(function(e){a._getCurrentGamePrompt()}).catch(function(e){return console.log(e)})},a.state={gamePrompt:null},a}return Object(k.a)(n,[{key:"componentDidMount",value:function(){this._getCurrentGamePrompt()}},{key:"render",value:function(){var e={channel:"PlayerChannel",id:this.props.playerId};return null===this.state.gamePrompt?E.a.createElement("div",null,"hang on..."):N.a.isEmpty(this.state.gamePrompt)?E.a.createElement("div",null,"Wait for other players..."):E.a.createElement("div",{className:"Vote"},E.a.createElement(D.ActionCableConsumer,{channel:e,onReceived:this.handleReceivedPlayerMessage}),this._renderVote())}},{key:"_renderVote",value:function(){var e=this.state.gamePrompt;if(e)return E.a.createElement("div",null,E.a.createElement("div",null,"vote now:"),e.text,E.a.createElement("div",null,this._renderResponses(e)))}},{key:"_renderResponses",value:function(e){var t=this;return e.responses.map(function(e){return E.a.createElement("button",{className:"Vote-option",key:e.id,onClick:function(n){return t._onClick(n,e.id)},disabled:!e.selectable},e.text)})}}]),n}(_.Component),V=n(47);function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(j.a)(e);if(t){var r=Object(j.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(w.a)(this,n)}}var L=function(e){Object(R.a)(n,e);var t=F(n);function n(){return Object(C.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"render",value:function(){var e=this.props.playerId,t=this.props.game.winners.map(function(e){return e.name});return"started"===this.props.game.state||"final_question_opened"===this.props.game.state?E.a.createElement(U,{playerId:e}):"voting_opened"===this.props.game.state||"final_voting_opened"===this.props.game.state?E.a.createElement(W,{playerId:e,game:this.props.game}):"finished"===this.props.game.state?(t.length>1?"Congrats to the winners, ":"Congrats to the winner, ")+t:"art"===this.props.game.state?E.a.createElement(V.a,{onChange:function(){return console.log("onChange")}}):"Game will start soon...Maybe a join code goes here."}}]),n}(_.Component),q=n(13);function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(j.a)(e);if(t){var r=Object(j.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(w.a)(this,n)}}var Q=function(e){Object(R.a)(n,e);var t=K(n);function n(e){var a;return Object(C.a)(this,n),(a=t.call(this,e)).handleReceivedGame=function(e){"Game"===e.message_type&&a.setState({game:e})},a._onSubmit=function(e){e.preventDefault();var t=e.target.elements[0].value;S.a.post("players",{game_id:a.props.id,name:t}).then(function(e){a.props.setCookies(e.data.id,a.props.id),a.setState({player:e.data})}).catch(function(e){return console.log(e)})},a._onSubmitName=function(e){e.preventDefault();var t=e.target.elements[0].value;S.a.put("players/"+a.state.player.id,{name:t,playing:!0}).then(function(e){a.setState({player:e.data})}).catch(function(e){return console.log(e)})},a._onClickJustWatching=function(e){S.a.put("players/"+a.state.player.id,{playing:!1}).then(function(e){a.setState({player:e.data})}).catch(function(e){return console.log(e)})},a.state={game:null,player:null,messages:[]},a}return Object(k.a)(n,[{key:"componentDidMount",value:function(){var e=this;S.a.defaults.baseURL="/api",S.a.get("games/"+this.props.id).then(function(t){e.setState({game:t.data})}).catch(function(e){return console.log(e)});var t=new q.a;t.get("player_id")&&S.a.get("players/"+t.get("player_id")).then(function(t){e.setState({player:t.data})}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){var e={channel:"GameChannel",id:this.props.id},t="http:"===window.location.protocol?"ws://":"wss://",n=window.location.port?":3001":"";return this.state.game?E.a.createElement(D.ActionCableProvider,{url:"".concat(t).concat(window.location.hostname).concat(n,"/cable")},E.a.createElement("div",{className:"App"},E.a.createElement(D.ActionCableConsumer,{channel:e,onReceived:this.handleReceivedGame}),E.a.createElement("header",{className:"App-header"},E.a.createElement(x,{game_id:this.props.id,player:this.state.player}),E.a.createElement("button",{onClick:this.props.unsetCookies,className:"small"},"Leave the game now")),E.a.createElement("div",{className:"App-body"},E.a.createElement("div",{className:"App-player"},this._renderPlayer()),E.a.createElement(G,{game_id:this.props.id,player:this.state.player,winners:this.state.game.winners})))):E.a.createElement("div",{className:"App"},E.a.createElement("header",{className:"App-header"},"hang on..."))}},{key:"_renderPlayer",value:function(){var e=this.state.player;return e?e.admin&&null==e.playing?E.a.createElement(E.a.Fragment,null,this._renderJustWatching(),"OR:",E.a.createElement("form",{onSubmit:this._onSubmitName,autoComplete:"off",maxlength:20},E.a.createElement("input",{name:"name",placeholder:"player name"}),E.a.createElement("button",null,"OK"))):E.a.createElement(L,{playerId:this.state.player.id,game:this.state.game}):E.a.createElement(E.a.Fragment,null,E.a.createElement("form",{onSubmit:this._onSubmit,autoComplete:"off",maxlength:20},E.a.createElement("input",{name:"name",placeholder:"player name"}),E.a.createElement("button",null,"OK")))}},{key:"_renderJustWatching",value:function(){return E.a.createElement("button",{onClick:this._onClickJustWatching},"Just Watching!")}}]),n}(_.Component);function T(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(j.a)(e);if(t){var r=Object(j.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(w.a)(this,n)}}var B=function(e){Object(R.a)(n,e);var t=T(n);function n(e){var a;Object(C.a)(this,n),(a=t.call(this,e)).onClickGame=function(){S.a.get("games/current.json").then(function(e){a.setState({gameId:e.data.id})}).catch(function(e){return console.log(e)})},a._onClickNewGame=function(e){e.preventDefault(),S.a.post("games.json").then(function(e){a._setCookies(e.data.started_by_id,e.data.id),a.setState({gameId:e.data.id})})};var r=new q.a;return a.state={games:[],gameId:r.get("game_id")},a}return Object(k.a)(n,[{key:"componentWillMount",value:function(){document.title="Generic websocket-based game",S.a.defaults.baseURL="/api"}},{key:"render",value:function(){var e=this;return this.state.gameId?E.a.createElement(Q,{id:this.state.gameId,setCookies:this._setCookies,unsetCookies:function(){return e._unsetCookies()}}):E.a.createElement("div",{className:"App"},E.a.createElement("header",{className:"App-header"}),E.a.createElement("div",{className:"game-links"},E.a.createElement("button",{onClick:this.onClickGame}," Join the existing game ")),E.a.createElement("div",{className:"new-game"},E.a.createElement("button",{onClick:this._onClickNewGame},"Start your own game")))}},{key:"_setCookies",value:function(e,t){var n=new q.a;n.set("player_id",e,{path:"/"}),n.set("game_id",t,{path:"/"})}},{key:"_unsetCookies",value:function(){var e=new q.a;e.remove("player_id"),e.remove("game_id"),this.setState({gameId:null})}}]),n}(_.Component),$=[{path:"/",action:function(){return E.a.createElement(B,null)}},{path:"/games/:id",id:"foo",action:function(e){return E.a.createElement(Q,e)}}],z=document.getElementById("root");function H(e){o.a.render(e,z)}function X(e){b.resolve($,e).then(H).catch(function(t){return b.resolve($,Object(a.a)({},e,{error:t})).then(H)})}S.a.defaults.baseURL="/api",X(l.getCurrentLocation()),l.listen(X)},32:function(e,t,n){},48:function(e,t,n){e.exports=n(100)},53:function(e,t,n){},90:function(e,t,n){},92:function(e,t,n){},93:function(e,t,n){}},[[48,1,2]]]);
//# sourceMappingURL=main.303120bc.chunk.js.map